{% extends "base.html" %}

{% block title %}Cadastro de Reciclagem{% endblock %}

{% block content %}
<div class="container-fluid flex-grow-1 container-p-y">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <div class="card border-2 border-dark rounded mb-5 shadow-sm">
        <div class="card-body">
          <h2 class="card-title mb-4">
            {% if edit %}
              <i class="bi bi-pencil-square me-2"></i>Editar Reciclagem
            {% else %}
              <i class="bi bi-plus-circle me-2"></i>Cadastrar Reciclagem
            {% endif %}
          </h2>

          <form method="post" class="row g-3">
            {% csrf_token %}

            <!-- Nome -->
            <div class="col-12 col-md-6">
              {{ form.nome.label_tag }} {{ form.nome }}
              {% if form.nome.errors %}
              <div class="invalid-feedback d-block">
                {{ form.nome.errors|striptags }}
              </div>
              {% endif %}
            </div>

            <!-- Matrícula -->
            <div class="col-12 col-md-6">
              {{ form.matricula.label_tag }} {{ form.matricula }}
              {% if form.matricula.errors %}
              <div class="invalid-feedback d-block">
                {{ form.matricula.errors|striptags }}
              </div>
              {% endif %}
            </div>

            <!-- Turma -->
            <div class="col-12 col-md-6">
              {{ form.turma.label_tag }} {{ form.turma }}
              {% if form.turma.errors %}
              <div class="invalid-feedback d-block">
                {{ form.turma.errors|striptags }}
              </div>
              {% endif %}
            </div>

            <!-- Turno -->
            <div class="col-12 col-md-6">
              {{ form.turno.label_tag }} {{ form.turno }}
              {% if form.turno.errors %}
              <div class="invalid-feedback d-block">
                {{ form.turno.errors|striptags }}
              </div>
              {% endif %}
            </div>

            <!-- Semestre -->
            <div class="col-12 col-md-6">
              {{ form.semestre.label_tag }} {{ form.semestre }}
              {% if form.semestre.errors %}
              <div class="invalid-feedback d-block">
                {{ form.semestre.errors|striptags }}
              </div>
              {% endif %}
            </div>

            <!-- Unidade -->
            <div class="col-12 col-md-6">
              {{ form.unidade.label_tag }} {{ form.unidade }}
              {% if form.unidade.errors %}
              <div class="invalid-feedback d-block">
                {{ form.unidade.errors|striptags }}
              </div>
              {% endif %}
            </div>

            <!-- Tipo de Resíduo -->
            <div class="col-12 col-md-6">
              {{ form.tipo_residuo.label_tag }} {{ form.tipo_residuo }}
              {% if form.tipo_residuo.errors %}
              <div class="invalid-feedback d-block">
                {{ form.tipo_residuo.errors|striptags }}
              </div>
              {% endif %}
            </div>

            <!-- Quantidade -->
            <div class="col-12 col-md-6">
              {{ form.quantidade.label_tag }} {{ form.quantidade }}
              {% if form.quantidade.errors %}
              <div class="invalid-feedback d-block">
                {{ form.quantidade.errors|striptags }}
              </div>
              {% endif %}
            </div>

            <!-- Botões -->
            <div class="col-12 d-flex">
              <button type="submit" class="btn btn-primary btn-sm me-2">
                {% if edit %}Atualizar{% else %}Cadastrar{% endif %}
              </button>
              {% if edit %}
              <a href="{% url 'reciclagem:ser_recicla_list' %}" class="btn btn-secondary btn-sm">
                Cancelar
              </a>
              {% endif %}
            </div>
          </form>
        </div>
      </div>

      <!-- Lista de registros -->
      <h2 class="mb-3">Lista de Registros</h2>
      <div class="table-responsive">
        <table class="table table-sm table-bordered table-striped table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th>Nome</th>
              <th>Matrícula</th>
              <th>Turma</th>
              <th>Turno</th>
              <th>Semestre</th>
              <th>Unidade</th>
              <th>Tipo</th>
              <th class="text-end">Qtd.</th>
              <th class="text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for reg in registros %}
            <tr>
              <td>{{ reg.nome }}</td>
              <td>{{ reg.matricula }}</td>
              <td>{{ reg.turma }}</td>
              <td>{{ reg.get_turno_display }}</td>
              <td>{{ reg.semestre }}</td>
              <td>{{ reg.get_unidade_display }}</td>
              <td>{{ reg.tipo_residuo.nome }}</td>
              <td class="text-end">{{ reg.quantidade }}</td>
              <td class="text-center">
                <a href="{% url 'reciclagem:ser_recicla_edit' reg.pk %}" class="btn btn-sm btn-warning me-1">
                  <i class="bi bi-pencil"></i>
                </a>
                <a href="{% url 'reciclagem:ser_recicla_delete' reg.pk %}" class="btn btn-sm btn-danger" onclick="return confirm('Confirmar exclusão?');">
                  <i class="bi bi-trash"></i>
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="9" class="text-center">Nenhum registro encontrado.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
